# rftf
Team Octo-Guacamole

Hello this is Connor.

So the initial commit has a couple different things.

`jstemplatemaker.js` - This is the prototype template webpage. Should run without any set up.

`textract_test.py` - Mostly just a demo of turning a PDF into a JPG, getting the OCR results back from Textract, and then using those results and the coordinates from a json file generated by `jstemplatemaker.js` to get labelled text data.

### AWS Lambda sucks

Alright so the `lambdas` folder contains all my failed experiments with AWS Lambda. 

So basically AWS Lambda is a way to quickly spin up a computer in Amazon's cloud and run a short function on it. It's like EC2 but more lightweight. We can also trigger an AWS Lambda when other AWS events happen, like putting files in our S3 bucket. For our project, the idea is to use incoming PDFs that get stored in our S3 bucket--or maybe an API call to an AWS endpoint--to trigger an AWS Lambda function that will take the triggering file, turn it into a group of JPGs (one for each page), and then put the JPGs in a new S3 bucket, which will later be run through Textract and put into our SQL database etc etc. 

Lambda is super cool if you're just running a short program that doesn't use libraries, or uses libraries that are written solely in the native language. But if you're trying to run it with precompiled binary libraries, like virtually every imaging library out there, it's a lot tougher to work with.

Lambda code is run in the Amazon Linux operating system, which is basically the CentOS distro, and you only have minimal control over the execution environment and surrounding filesystem during the function's execution. You can use 3rd party libraries and other resources with Lambda by using Deployment Packages, which are zip files that you prepare locally in your development environment and then push to AWS through the AWS CLI. AWS basically takes the zip file, extracts it to one of their server machines, runs the handler code, and then wipes everything once a short period of time has passed since the last Lambda invocation.

There are no PDF to JPG libraries that use only native libraries in any of Lambda's supported Languages (Nodejs, Python, Java, Go, .NET C#). All of them require installing some kind of 3rd party library. The problem is, every PDF to JPG library I've checked (Ghostscript, pdf2image, pdf.js, GraphicsMagick, ImageMagick, etc) isn't pure Python/Nodejs/Java. They seem to rely on binary executables compiled from C/C++. It runs faster this way, but this is bad because binary executables have to be built in the same operating system environment that they are going to be run on. So if I build GraphicsMagick (which seems to be the base utility that all the other libraries are using) in my own Windows operating system, the binaries are only going to work on Windows. Which AWS Lambda is not using.

What I've done is spun up a docker container that is using an Amazon Linux image. Basically a lightweight virtual machine. My most promising attempt is in the `pdf2image` folder. I built GraphicsMagick, Ghostscript, and several other dependencies that are required to get the pdf2image NPM library to work for Node.js, and then copied the built binaries and some other required object files out of the docker container and into the `pdf2image` folder. Then I zipped that folder up and deployed it to Lambda. This is what `upload.bat` does.

`index.js` is the code that Lambda will run first. `index.js` in turn uses the pdf2img library in `npm_modules`. It basically rearranges the Lambda machine's internal filesystem and changes permissions to allow me to use the binary executables I gave it in the Deployment Package, then it pulls a PDF from my S3 and attempts to convert it to JPG and return some info about the JPGs. 

After all this... it still doesn't work. And worse, it no longer gives me any error information. Lambda just times out during the pdf2img.convert function with no error or warning whatsoever. Incredibly frustrating. 

